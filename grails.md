# Grails Practice【[中文版](grails_cn.md)】

Since microservice is very popular today, we use grails as a tool for building backend services. The following tips focus on a rest-api project.

// TODO: a grails project template based on the following tips.

## GORM

- Postgresql Specific Tips
  - Plugin: [grails-postgresql-extensions](https://github.com/kaleidos/grails-postgresql-extensions)
  - Autoincrement domain id which will be mapped to serial type in PG.
  ~~~
        grails.gorm.default.mapping = {
            id generator: 'identity'
        }
  ~~~
- Set "failOnError" to true.
- Use [Hikari Connection pool](https://github.com/brettwooldridge/HikariCP).
- Use the db used in production env for testing because you can find some bugs related to that db as soon as possible.
- Value of "dbCreate":
  - development & production: none, use db migration instead.
  - test: create-drop
- Use unicode for db character encoding.
- Don't use db admin for db connection, instead, create an user for your application and grant permissions to that user.
- Add column comments in domain classes, eg:
~~~
    class Order {

        User buyer
        Map address
        LocalDateTime dateCreated

        static constraints = { ... }

        static mapping = {
            comment '订单'
            buyer comment: '用户', index: 'idx_order_user_id'
            address comment: '收货地址'
            dateCreated comment: '创建时间'
        }

    }
~~~
- Use "idx_$table" as a prefix for index name:
  - single column: idx_$table_$col
  - multicolumns: idx_$table_$name
- Use long for money, unit is cent.
- For insert only domain class, set version false.
~~~
    static mapping = {
        version false
    }
~~~
- User java8 datetime in Domain Class.
- open "showSql" and "formatSql" for debugging sqls generated by Hibernate
- No bidirection association in domain classes.
- No hasMany, for many-to-many association, use three domain classes instead:
  - Domain A
  - Domain B
  - Domain AB, which includes associations with A and B.
- For gaint domain: dynamicUpdate true
- If dynamicUpdate = true, for those cols updated in beforeValidate, use dirty.
- No associations in domains used as information logs.
- No validator abuse, for complex validation, put it in a service.

## Controller

- Don't invoke any persitence methods of a domain, use service.

## Specification

## Db Migration

## Security